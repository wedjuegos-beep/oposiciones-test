<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma Multi-Oposiciones</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --dark: #343a40; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; margin: 5px 0; width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-exit { background: #6c757d; color: white; margin-top: 20px; }
        select, input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
        .hidden { display: none; }
        .pregunta-texto { font-size: 1.2em; font-weight: bold; margin-bottom: 20px; color: var(--dark); }
        .opcion { display: block; padding: 15px; margin: 8px 0; background: #f8f9fa; border: 2px solid #eee; border-radius: 8px; cursor: pointer; }
        .correcta { background: #d4edda !important; border-color: #28a745 !important; }
        .incorrecta { background: #f8d7da !important; border-color: #dc3545 !important; }
        .feedback { background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 5px solid #ffc107; }
    </style>
</head>
<body>

<div class="container">
    <div id="vistaOposicion" class="card">
        <h1 style="text-align: center;">ğŸ›ï¸ Elige tu OposiciÃ³n</h1>
        <button class="btn btn-primary" onclick="seleccionarOpo('tai')">TÃ©cnico Auxiliar InformÃ¡tica (TAI)</button>
        <button class="btn btn-success" onclick="seleccionarOpo('auxiliar')">Auxiliar Administrativo Valencia</button>
    </div>

    <div id="vistaConfig" class="card hidden">
        <button onclick="location.reload()" style="float: right; border: none; background: none; cursor: pointer;">â¬…ï¸ Cambiar OposiciÃ³n</button>
        <h2 id="tituloOpo">ConfiguraciÃ³n</h2>
        
        <label><b>Seleccionar Examen o Bloque:</b></label>
        <select id="selectTest"></select>

        <label><b>NÃºmero de preguntas:</b></label>
        <input type="number" id="numPreguntas" value="80" min="1">
        
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-success" onclick="iniciarExamen(false)">ENTRENAMIENTO</button>
            <button class="btn btn-primary" onclick="iniciarExamen(true)">MODO EXAMEN</button>
        </div>
    </div>

    <div id="vistaTest" class="card hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px;">
            <span id="progreso">Pregunta 1/--</span>
            <div id="timerContainer" class="hidden">â±ï¸ <span id="timer">120:00</span></div>
        </div>
        <div id="contenedorPregunta"></div>
        <button id="btnSiguiente" class="btn btn-primary hidden" onclick="siguiente()">Siguiente Pregunta</button>
        <button class="btn btn-exit" onclick="confirmarSalida()">âœ– Salir</button>
    </div>

    <div id="vistaResultados" class="card hidden" style="text-align: center;">
        <h2>Fin del examen</h2>
        <div id="puntuacionFinal" style="font-size: 3em; margin: 20px 0;">0 / 0</div>
        <button class="btn btn-primary" onclick="location.reload()">Volver al Inicio</button>
    </div>
</div>

<script>
    let oposicionActual = '';
    const examenes = {
        tai: {
            titulo: "ğŸš€ OposiciÃ³n TAI",
            max: 80,
            carpeta: "tests/tai/",
            lista: [
                { id: "test_oficial_1.json", nombre: "ğŸ† Oficial 01" },
                { id: "test_oficial_2.json", nombre: "ğŸ† Oficial 02" },
                // ... aÃ±adir del 3 al 15 igual
                { id: "bloque_1.json", nombre: "ğŸ“ Bloque I: Derecho" },
                { id: "bloque_2.json", nombre: "ğŸ“ Bloque II: TecnologÃ­a" },
                { id: "bloque_3.json", nombre: "ğŸ“ Bloque III: InformÃ¡tica" },
                { id: "bloque_4.json", nombre: "ğŸ“ Bloque IV: Redes" }
            ]
        },
        auxiliar: {
            titulo: "ğŸ“ Aux. Administrativo Valencia",
            max: 50,
            carpeta: "tests/auxiliar/",
            lista: [
                { id: "oficial_1.json", nombre: "ğŸ† Oficial 01 (Valencia)" },
                { id: "bloque_1.json", nombre: "ğŸ“ Bloque 1" },
                { id: "bloque_2.json", nombre: "ğŸ“ Bloque 2" },
                { id: "bloque_3.json", nombre: "ğŸ“ Bloque 3" }
            ]
        }
    };

    // Generar los 15 para TAI automÃ¡ticamente en el objeto
    for(let i=3; i<=15; i++) {
        examenes.tai.lista.push({ id: `test_oficial_${i}.json`, nombre: `ğŸ† Oficial ${i < 10 ? '0'+i : i}` });
    }

    function seleccionarOpo(tipo) {
        oposicionActual = tipo;
        const opo = examenes[tipo];
        
        document.getElementById('vistaOposicion').classList.add('hidden');
        document.getElementById('vistaConfig').classList.remove('hidden');
        document.getElementById('tituloOpo').textContent = opo.titulo;
        document.getElementById('numPreguntas').value = opo.max;
        document.getElementById('numPreguntas').max = opo.max;

        const select = document.getElementById('selectTest');
        select.innerHTML = '';
        opo.lista.forEach(ex => {
            const opt = document.createElement('option');
            opt.value = ex.id;
            opt.textContent = ex.nombre;
            select.appendChild(opt);
        });
    }

    // --- EL RESTO DEL CÃ“DIGO (iniciarExamen, chequear, etc.) SE MANTIENE IGUAL ---
    // Solo actualizamos la URL de carga:
    let preguntas = [];
    let actual = 0;
    let aciertos = 0;
    let modoExamen = false;
    let intervalo;

    async function iniciarExamen(examen) {
        const file = document.getElementById('selectTest').value;
        const url = `${examenes[oposicionActual].carpeta}${file}`; 

        try {
            const res = await fetch(url);
            if (!res.ok) throw new Error();
            const data = await res.json();
            
            preguntas = data.sort(() => Math.random() - 0.5).slice(0, document.getElementById('numPreguntas').value);
            modoExamen = examen;
            
            document.getElementById('vistaConfig').classList.add('hidden');
            document.getElementById('vistaTest').classList.remove('hidden');
            if (modoExamen) {
                document.getElementById('timerContainer').classList.remove('hidden');
                let t = 120 * 60;
                intervalo = setInterval(() => {
                    t--;
                    let m = Math.floor(t / 60);
                    let s = t % 60;
                    document.getElementById('timer').textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
                    if (t <= 0) finalizar();
                }, 1000);
            }
            mostrar();
        } catch (e) {
            alert(`âš ï¸ Error: No existe ${url} en tu GitHub.`);
        }
    }

    function mostrar() {
        const p = preguntas[actual];
        document.getElementById('progreso').textContent = `Pregunta ${actual + 1} de ${preguntas.length}`;
        let html = `<div class="pregunta-texto">${p.pregunta}</div>`;
        p.opciones.forEach((o, i) => {
            html += `<div class="opcion" onclick="chequear(${i}, this)">${o}</div>`;
        });
        document.getElementById('contenedorPregunta').innerHTML = html;
        document.getElementById('btnSiguiente').classList.add('hidden');
    }

    function chequear(idx, el) {
        const p = preguntas[actual];
        const opciones = document.querySelectorAll('.opcion');
        opciones.forEach(o => o.style.pointerEvents = 'none');
        if (idx === p.correcta) { el.classList.add('correcta'); aciertos++; }
        else { el.classList.add('incorrecta'); opciones[p.correcta].classList.add('correcta'); }
        if (!modoExamen) {
            const f = document.createElement('div'); f.className = "feedback";
            f.innerHTML = `<strong>ğŸ’¡ ExplicaciÃ³n:</strong> ${p.explicacion || "Sin explicaciÃ³n."}`;
            document.getElementById('contenedorPregunta').appendChild(f);
        }
        document.getElementById('btnSiguiente').classList.remove('hidden');
    }

    function siguiente() {
        actual++;
        if (actual < preguntas.length) mostrar();
        else finalizar();
    }

    function finalizar() {
        clearInterval(intervalo);
        document.getElementById('vistaTest').classList.add('hidden');
        document.getElementById('vistaResultados').classList.remove('hidden');
        document.getElementById('puntuacionFinal').textContent = `${aciertos} / ${preguntas.length}`;
    }

    function confirmarSalida() { if (confirm("Â¿Salir?")) location.reload(); }
</script>
</body>
</html>
