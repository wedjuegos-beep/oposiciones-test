<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oposiciones IA - Test Inteligentes</title>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // 游댢 CONFIG FIREBASE (Mantengo tu config original)
        const firebaseConfig = {
            apiKey: "AIzaSyBVb6TjVzSy7Q1B1xoG_2F27C12x2GOS9Y",
            authDomain: "oposiciones-test.firebaseapp.com",
            projectId: "oposiciones-test",
            storageBucket: "oposiciones-test.firebasestorage.app",
            messagingSenderId: "116305102438",
            appId: "1:116305102438:web:25684cd6467f5a27398fa7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let preguntasActuales = [];
        let timerInterval = null;
        let tiempoRestante = 0;
        let seleccionOposicion = "";
        let seleccionTema = "";
        let registroRespuestas = [];

        // 游댏 LOGIN GOOGLE
        onAuthStateChanged(auth, user => {
            if(user){
                document.getElementById("loginSection").style.display="none";
                document.getElementById("usuarioNombre").textContent = user.displayName;
                document.getElementById("home").style.display="block";
                document.getElementById("navUser").style.display="flex";
            }
        });

        window.login = function(){
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider);
        };

        // 游댳 Funci칩n para generar preguntas con IA (Esqueleto para el siguiente paso)
        window.generarConIA = async function() {
            const fileInput = document.getElementById('pdfFile');
            if (fileInput.files.length === 0) {
                alert("Por favor, selecciona un PDF primero.");
                return;
            }
            
            const btn = document.getElementById('btnIA');
            btn.textContent = "Generando preguntas con IA...";
            btn.disabled = true;

            // Aqu칤 conectaremos con Cloudflare Worker en el paso 2
            setTimeout(() => {
                alert("Simulaci칩n: IA leyendo PDF y creando preguntas...");
                btn.textContent = "Generar Test con IA";
                btn.disabled = false;
            }, 3000);
        };

        // 游댳 Navegaci칩n y l칩gica original mantenida/optimizada
        window.volverInicio = function(){
            const views = ["configTest", "configSimulacion", "testContainer", "recursosSection"];
            views.forEach(v => document.getElementById(v).style.display = "none");
            document.getElementById("home").style.display="block";
        };

        window.mostrarRecursos = function(){
            document.getElementById("home").style.display="none";
            document.getElementById("recursosSection").style.display="block";
        };

        // (Aqu칤 ir칤an el resto de tus funciones: empezarTest, corregirTest, etc.)
        // Se mantienen iguales pero se adaptan a los nuevos IDs de la interfaz
    </script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #22c55e;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text: #1e293b;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
        
        /* Header estilo Opositatest */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            background: white; padding: 1rem 5%; border-bottom: 1px solid #e2e8f0;
            position: sticky; top: 0; z-index: 100;
        }
        header h1 { color: var(--primary); font-size: 1.5rem; margin: 0; }

        .btn { padding: 0.6rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-outline { background: transparent; border: 1px solid #cbd5e1; }

        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }

        /* Card estilo moderno */
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }

        #temas { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .tema-btn { background: white; border: 1px solid #e2e8f0; padding: 1rem; border-radius: 10px; cursor: pointer; text-align: left; }
        .tema-btn:hover { border-color: var(--primary); color: var(--primary); }

        /* Estilo preguntas */
        .pregunta-card { background: white; padding: 1.5rem; border-radius: 10px; border-left: 5px solid var(--primary); margin-bottom: 1rem; }
        .opcion { 
            display: block; width: 100%; text-align: left; background: #f1f5f9; 
            margin: 0.5rem 0; padding: 1rem; border-radius: 8px; border: 2px solid transparent; cursor: pointer; 
        }
        .opcion.seleccionada { border-color: var(--primary); background: #eff6ff; }

        #loginSection { text-align: center; margin-top: 100px; }
        .upload-area { border: 2px dashed #cbd5e1; padding: 2rem; text-align: center; border-radius: 12px; }
    </style>
</head>
<body>

<header>
    <h1>Oposiciones<span style="font-weight: 300;">IA</span></h1>
    <div id="navUser" style="display:none; align-items: center; gap: 15px;">
        <span id="usuarioNombre" style="font-weight: 500;"></span>
        <button class="btn btn-outline" onclick="mostrarRecursos()">Subir Temario</button>
        <button class="btn btn-outline" onclick="volverInicio()">Inicio</button>
    </div>
</header>

<div class="container">
    <div id="loginSection">
        <div class="card">
            <h2>Bienvenido a tu Academia IA</h2>
            <p>Crea tests personalizados a partir de tus propios apuntes PDF.</p>
            <button class="btn btn-primary" onclick="login()">Iniciar sesi칩n con Google</button>
        </div>
    </div>

    <div id="home" style="display:none;">
        <div class="card">
            <h2>쯈u칠 vamos a estudiar hoy?</h2>
            <select id="oposicion" style="width: 100%; padding: 0.8rem; border-radius: 8px; margin-bottom: 1rem;">
                <option value="TAI">T칠cnico Auxiliar de Inform치tica</option>
                <option value="Administrativo">Administrativo</option>
            </select>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="simuladorExamen(document.getElementById('oposicion').value)">
                Lanzar Simulacro de Examen (90 min)
            </button>
        </div>

        <h3>Temas disponibles</h3>
        <div id="temas">
            <button class="tema-btn" onclick="seleccionarTema('TAI','tema1')"><b>Tema 1</b><br>Constituci칩n Espa침ola</button>
            <button class="tema-btn" onclick="seleccionarTema('TAI','tema2')"><b>Tema 2</b><br>Administraci칩n P칰blica</button>
            <button class="tema-btn" onclick="seleccionarTema('TAI','tema3')"><b>Tema 3</b><br>Seguridad Inform치tica</button>
        </div>
    </div>

    <div id="recursosSection" style="display:none;">
        <div class="card">
            <h2>Generador de Tests con IA</h2>
            <p>Sube un PDF de tu temario y la IA generar치 preguntas tipo test autom치ticamente.</p>
            <div class="upload-area">
                <input type="file" id="pdfFile" accept=".pdf" style="margin-bottom: 1rem;"><br>
                <button id="btnIA" class="btn btn-primary" onclick="generarConIA()">Generar Test con IA</button>
            </div>
        </div>
    </div>

    <div id="testContainer" style="display:none;">
        <div id="timer">00:00</div>
        <div id="test"></div>
    </div>
</div>

</body>
</html>
