<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Tests TAI</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --dark: #343a40; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e9ecef; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; margin: 5px 0; width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-exit { background: #6c757d; color: white; margin-top: 20px; }
        select, input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
        .hidden { display: none; }
        .pregunta-texto { font-size: 1.2em; font-weight: bold; margin-bottom: 20px; color: var(--dark); }
        .opcion { display: block; padding: 15px; margin: 8px 0; background: #f8f9fa; border: 2px solid #eee; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .opcion:hover { background: #e9ecef; border-color: #ddd; }
        .correcta { background: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .incorrecta { background: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }
        .feedback { background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 5px solid #ffc107; }
        #timer { font-weight: bold; color: var(--danger); font-size: 1.2em; }
    </style>
</head>
<body>

<div class="container">
    <div id="vistaConfig" class="card">
        <h1 style="text-align: center; color: var(--dark);">üéØ Preparador Oficial TAI</h1>
        <p style="text-align: center; color: #666;">Selecciona un examen de los 15 oficiales o por temas</p>
        
        <label><b>Seleccionar Examen:</b></label>
        <select id="selectTest"></select>

        <label><b>N√∫mero de preguntas:</b></label>
        <input type="number" id="numPreguntas" value="80" min="1" max="100">
        
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn btn-success" onclick="iniciarExamen(false)">ENTRENAMIENTO</button>
            <button class="btn btn-primary" onclick="iniciarExamen(true)">MODO EXAMEN</button>
        </div>
    </div>

    <div id="vistaTest" class="card hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px;">
            <span id="progreso" style="font-weight: bold;">Pregunta 1/80</span>
            <div id="timerContainer" class="hidden">‚è±Ô∏è <span id="timer">120:00</span></div>
        </div>

        <div id="contenedorPregunta"></div>
        
        <button id="btnSiguiente" class="btn btn-primary hidden" onclick="siguiente()">Siguiente Pregunta</button>
        <button class="btn btn-exit" onclick="confirmarSalida()">‚úñ Salir del Test</button>
    </div>

    <div id="vistaResultados" class="card hidden" style="text-align: center;">
        <h2>Examen Finalizado</h2>
        <div id="puntuacionFinal" style="font-size: 3em; margin: 20px 0;">0 / 0</div>
        <p id="mensajeResultado"></p>
        <button class="btn btn-primary" onclick="location.reload()">Volver a Intentarlo</button>
    </div>
</div>

<script>
    // LISTA DE 15 TESTS OFICIALES + TEMAS
    const listaExamenes = [
        { id: "test_oficial_1.json", nombre: "üèÜ Examen Oficial 01" },
        { id: "test_oficial_2.json", nombre: "üèÜ Examen Oficial 02" },
        { id: "test_oficial_3.json", nombre: "üèÜ Examen Oficial 03" },
        { id: "test_oficial_4.json", nombre: "üèÜ Examen Oficial 04" },
        { id: "test_oficial_5.json", nombre: "üèÜ Examen Oficial 05" },
        { id: "test_oficial_6.json", nombre: "üèÜ Examen Oficial 06" },
        { id: "test_oficial_7.json", nombre: "üèÜ Examen Oficial 07" },
        { id: "test_oficial_8.json", nombre: "üèÜ Examen Oficial 08" },
        { id: "test_oficial_9.json", nombre: "üèÜ Examen Oficial 09" },
        { id: "test_oficial_10.json", nombre: "üèÜ Examen Oficial 10" },
        { id: "test_oficial_11.json", nombre: "üèÜ Examen Oficial 11" },
        { id: "test_oficial_12.json", nombre: "üèÜ Examen Oficial 12" },
        { id: "test_oficial_13.json", nombre: "üèÜ Examen Oficial 13" },
        { id: "test_oficial_14.json", nombre: "üèÜ Examen Oficial 14" },
        { id: "test_oficial_15.json", nombre: "üèÜ Examen Oficial 15" },
        { id: "tema_1.json", nombre: "üìÅ Bloque I: Derecho y Adm. P√∫blica" },
        { id: "tema_2.json", nombre: "üìÅ Bloque II: Tecnolog√≠a B√°sica" }
    ];

    let preguntas = [];
    let actual = 0;
    let aciertos = 0;
    let modoExamen = false;
    let tiempoRestante = 120 * 60; // 2 horas
    let intervalo;

    window.onload = () => {
        const select = document.getElementById('selectTest');
        listaExamenes.forEach(ex => {
            const opt = document.createElement('option');
            opt.value = ex.id;
            opt.textContent = ex.nombre;
            select.appendChild(opt);
        });
    };

    async function iniciarExamen(examen) {
        const file = document.getElementById('selectTest').value;
        // IMPORTANTE: Aseg√∫rate de que en GitHub la carpeta sea tests/tai/
        const url = `tests/tai/${file}`; 

        try {
            const res = await fetch(url);
            if (!res.ok) throw new Error();
            const data = await res.json();
            
            preguntas = data.sort(() => Math.random() - 0.5).slice(0, document.getElementById('numPreguntas').value);
            modoExamen = examen;
            
            document.getElementById('vistaConfig').classList.add('hidden');
            document.getElementById('vistaTest').classList.remove('hidden');
            
            if (modoExamen) {
                document.getElementById('timerContainer').classList.remove('hidden');
                iniciarCronometro();
            }
            
            mostrar();
        } catch (e) {
            alert(`‚ö†Ô∏è ARCHIVO NO ENCONTRADO: El archivo "${file}" a√∫n no ha sido subido a la carpeta tests/tai/ de tu GitHub.`);
        }
    }

    function iniciarCronometro() {
        intervalo = setInterval(() => {
            tiempoRestante--;
            let mins = Math.floor(tiempoRestante / 60);
            let secs = tiempoRestante % 60;
            document.getElementById('timer').textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            if (tiempoRestante <= 0) finalizar();
        }, 1000);
    }

    function mostrar() {
        const p = preguntas[actual];
        document.getElementById('progreso').textContent = `Pregunta ${actual + 1} de ${preguntas.length}`;
        let html = `<div class="pregunta-texto">${p.pregunta}</div>`;
        p.opciones.forEach((o, i) => {
            html += `<div class="opcion" onclick="chequear(${i}, this)">${o}</div>`;
        });
        document.getElementById('contenedorPregunta').innerHTML = html;
        document.getElementById('btnSiguiente').classList.add('hidden');
    }

    function chequear(idx, el) {
        const p = preguntas[actual];
        const opciones = document.querySelectorAll('.opcion');
        opciones.forEach(o => o.style.pointerEvents = 'none');

        if (idx === p.correcta) {
            el.classList.add('correcta');
            aciertos++;
        } else {
            el.classList.add('incorrecta');
            opciones[p.correcta].classList.add('correcta');
        }

        if (!modoExamen) {
            const f = document.createElement('div');
            f.className = "feedback";
            f.innerHTML = `<strong>üí° Explicaci√≥n:</strong> ${p.explicacion || "Sin explicaci√≥n disponible."}`;
            document.getElementById('contenedorPregunta').appendChild(f);
        }
        document.getElementById('btnSiguiente').classList.remove('hidden');
    }

    function siguiente() {
        actual++;
        if (actual < preguntas.length) mostrar();
        else finalizar();
    }

    function finalizar() {
        clearInterval(intervalo);
        document.getElementById('vistaTest').classList.add('hidden');
        document.getElementById('vistaResultados').classList.remove('hidden');
        document.getElementById('puntuacionFinal').textContent = `${aciertos} / ${preguntas.length}`;
    }

    function confirmarSalida() {
        if (confirm("¬øSeguro que quieres salir? Perder√°s el progreso del test actual.")) {
            location.reload();
        }
    }
</script>
</body>
</html>
