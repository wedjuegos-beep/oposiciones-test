<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preparador TAI - Test Manager</title>
    <style>
        :root { --primary: #007bff; --success: #28a745; --dark: #343a40; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        select, input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .hidden { display: none; }
        .pregunta { font-weight: bold; font-size: 1.1em; margin-bottom: 15px; }
        .opcion { display: block; padding: 10px; margin: 5px 0; background: #f1f3f5; border-radius: 5px; cursor: pointer; }
        .opcion:hover { background: #dee2e6; }
        .feedback { padding: 10px; margin-top: 10px; border-radius: 5px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <div id="vistaConfig" class="card">
        <h2>ðŸ“š Panel de Control TAI</h2>
        <p>Selecciona tu entrenamiento:</p>
        
        <label>Tipo de Test:</label>
        <select id="selectTest">
            </select>

        <label>NÃºmero de preguntas:</label>
        <input type="number" id="numPreguntas" value="80">
        
        <button class="btn btn-success" onclick="iniciarJuego(false)">MODO ENTRENAMIENTO</button>
        <button class="btn btn-primary" onclick="iniciarJuego(true)">MODO EXAMEN (CON TIEMPO)</button>
    </div>

    <div id="vistaTest" class="card hidden">
        <div id="infoTest" style="display:flex; justify-content:space-between; margin-bottom:10px; color:#666;">
            <span id="progreso">Pregunta 1 de --</span>
            <span id="cronometro">00:00</span>
        </div>
        <div id="contenedorPregunta"></div>
        <button id="btnSiguiente" class="btn btn-primary hidden" onclick="siguientePregunta()">Siguiente Pregunta</button>
    </div>

    <div id="vistaResultados" class="card hidden">
        <h2>Resultado Final</h2>
        <div id="puntuacion" style="font-size: 2em; text-align: center; margin: 20px 0;"></div>
        <button class="btn btn-primary" onclick="location.reload()">VOLVER AL INICIO</button>
    </div>
</div>

<script>
    // CONFIGURACIÃ“N DE TUS TESTS (AÃ±ade aquÃ­ los nuevos archivos que subas a GitHub)
    const misTests = [
        { nombre: "ðŸ† Examen Oficial 1", archivo: "test_oficial_1.json", categoria: "oficial" },
        { nombre: "ðŸ† Examen Oficial 2", archivo: "test_oficial_2.json", categoria: "oficial" },
        { nombre: "ðŸ† Examen Oficial 3", archivo: "test_oficial_3.json", categoria: "oficial" },
        { nombre: "ðŸ“ Tema 1: ConstituciÃ³n", archivo: "tema_1.json", categoria: "tema" },
        { nombre: "ðŸ“ Tema 2: Ley 39/2015", archivo: "tema_2.json", categoria: "tema" },
        { nombre: "ðŸ“ Simulacro Enero 2026", archivo: "simulacro_enero.json", categoria: "simulacro" }
    ];

    let preguntasCargadas = [];
    let indiceActual = 0;
    let aciertos = 0;
    let modoExamen = false;

    // Al cargar la pÃ¡gina, rellenamos el selector automÃ¡ticamente
    window.onload = () => {
        const select = document.getElementById('selectTest');
        misTests.forEach(test => {
            const opt = document.createElement('option');
            opt.value = test.archivo;
            opt.textContent = test.nombre;
            select.appendChild(opt);
        });
    };

    async function iniciarJuego(examen) {
        const nombreArchivo = document.getElementById('selectTest').value;
        const ruta = `tests/tai/${nombreArchivo}`;
        
        try {
            const response = await fetch(ruta);
            if (!response.ok) throw new Error("No se encontrÃ³ el archivo de test");
            const data = await response.json();
            
            preguntasCargadas = data.sort(() => Math.random() - 0.5).slice(0, document.getElementById('numPreguntas').value);
            modoExamen = examen;
            
            document.getElementById('vistaConfig').classList.add('hidden');
            document.getElementById('vistaTest').classList.remove('hidden');
            mostrarPregunta();
        } catch (error) {
            alert("Error al cargar el test: " + error.message);
        }
    }

    function mostrarPregunta() {
        const p = preguntasCargadas[indiceActual];
        document.getElementById('progreso').textContent = `Pregunta ${indiceActual + 1} de ${preguntasCargadas.length}`;
        
        let html = `<div class="pregunta">${p.pregunta}</div>`;
        p.opciones.forEach((opc, i) => {
            html += `<div class="opcion" onclick="validarRespuesta(${i}, this)">${opc}</div>`;
        });
        
        document.getElementById('contenedorPregunta').innerHTML = html;
        document.getElementById('btnSiguiente').classList.add('hidden');
    }

    function validarRespuesta(indiceSeleccionado, elemento) {
        const p = preguntasCargadas[indiceActual];
        const opciones = document.querySelectorAll('.opcion');
        
        // Deshabilitar clics
        opciones.forEach(o => o.style.pointerEvents = 'none');

        if (indiceSeleccionado === p.correcta) {
            elemento.style.background = "#d4edda";
            elemento.style.border = "2px solid #28a745";
            aciertos++;
        } else {
            elemento.style.background = "#f8d7da";
            elemento.style.border = "2px solid #dc3545";
            opciones[p.correcta].style.background = "#d4edda";
            opciones[p.correcta].style.border = "2px solid #28a745";
        }

        if (!modoExamen) {
            const feed = document.createElement('div');
            feed.className = "feedback";
            feed.style.background = "#fff3cd";
            feed.innerHTML = `<strong>ExplicaciÃ³n:</strong> ${p.explicacion}`;
            document.getElementById('contenedorPregunta').appendChild(feed);
        }

        document.getElementById('btnSiguiente').classList.remove('hidden');
    }

    function siguientePregunta() {
        indiceActual++;
        if (indiceActual < preguntasCargadas.length) {
            mostrarPregunta();
        } else {
            finalizarTest();
        }
    }

    function finalizarTest() {
        document.getElementById('vistaTest').classList.add('hidden');
        document.getElementById('vistaResultados').classList.remove('hidden');
        document.getElementById('puntuacion').textContent = `${aciertos} / ${preguntasCargadas.length}`;
    }
</script>

</body>
</html>
